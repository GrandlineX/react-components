"use strict";(self.webpackChunk_grandlinex_react_components=self.webpackChunk_grandlinex_react_components||[]).push([[3929],{"./src/components/mediaPlayer/player/TwitchPlayer.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_util__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/util/index.tsx");const TwitchPlayer=(0,react__WEBPACK_IMPORTED_MODULE_1__.forwardRef)((props,ref)=>{const[playling,setPlaying]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),embedRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),[init,setInit]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[player,setPlayer]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null),{playerProps}=props,{className,src,width,height,controls,autoplay,onEnded,onPause,onPlay,onStart,onDurationChange,onProgress,bottomRow}=playerProps,twitchInfo=function getTwitchInfo(src){const url="string"==typeof src?src:src.src,videoMatch=url.match(/twitch\.tv\/videos\/(\d+)/);if(videoMatch)return{type:"video",id:videoMatch[1]};const clipMatch=url.match(/clips\.twitch\.tv\/([a-zA-Z0-9_-]+)/);if(clipMatch)return{type:"clip",id:clipMatch[1]};const clipAltMatch=url.match(/twitch\.tv\/.+\/clip\/([a-zA-Z0-9_-]+)/);return clipAltMatch?{type:"clip",id:clipAltMatch[1]}:null}("string"==typeof src?src:"");return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(!(window.Twitch&&window.Twitch.Embed||document.getElementById("twitch-embed-script"))){const script=document.createElement("script");script.id="twitch-embed-script",script.src="https://embed.twitch.tv/embed/v1.js",document.body.appendChild(script)}},[]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(playling&&player&&onProgress){onDurationChange?.({target:player,currentTime:player.getPlayer?.()?.getCurrentTime?.()??0,duration:player.getPlayer?.()?.getDuration?.()??0});const interval=setInterval(()=>{onProgress?.({target:player,currentTime:player.getPlayer?.()?.getCurrentTime?.()??0,duration:player.getPlayer?.()?.getDuration?.()??0})},1e3);return()=>{clearInterval(interval)}}return()=>{}},[player,playling]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(init&&!player){const options={width:width||"100%",height:height||360,autoplay:!!autoplay,parent:[window.location.hostname]};"video"===twitchInfo.type?options.video=twitchInfo.id:options.clip=twitchInfo.id,options.controls=!0===controls;const pl=new window.Twitch.Embed(embedRef.current.id,options);return pl.addEventListener("play",()=>{setPlaying(!0),onPlay?.()}),pl.addEventListener("pause",()=>{setPlaying(!1),onPause?.()}),pl.addEventListener("ended",()=>{setPlaying(!1),onEnded?.()}),pl.addEventListener("ready",()=>{onDurationChange?.({target:pl,currentTime:pl.getPlayer?.()?.getCurrentTime?.()??0,duration:pl.getPlayer?.()?.getDuration?.()??0}),onStart?.()}),pl.addEventListener("playing",()=>{setPlaying(!0),onPlay?.()}),console.log(pl),pl.addEventListener("timeupdate",()=>{console.log("timeupdate")}),setPlayer(pl),()=>{pl&&(pl.removeEventListener?.("play",onPlay),pl.removeEventListener?.("pause",onPause),pl.removeEventListener?.("ended",onEnded),pl.removeEventListener?.("ready",onStart),pl.removeEventListener?.("playing",onPlay),pl.removeEventListener?.("timeupdate",onProgress))}}return()=>{}},[player,init]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{twitchInfo&&embedRef.current&&(window.Twitch&&window.Twitch.Embed?setInit(!0):document.getElementById("twitch-embed-script")?.addEventListener("load",()=>{setInit(!0)}))},[twitchInfo,embedRef]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useImperativeHandle)(ref,()=>({seekTo(to){player?.getPlayer?.()?.seek?.(to)},getRawPlayer:()=>player?.getPlayer?.(),play(){player?.getPlayer?.()?.play?.()},pause(){player?.getPlayer?.()?.pause?.()},getDuration:()=>player?.getPlayer?.()?.getDuration?.()??-1,getCurrentTime:()=>player?.getPlayer?.()?.getCurrentTime?.()??-1,setPlayBackRate(){}})),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:(0,_util__WEBPACK_IMPORTED_MODULE_2__._m)("glx-media-player",className),children:twitchInfo?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{ref:embedRef,id:`twitch-embed-${twitchInfo.type}-${twitchInfo.id}`,style:{width:width||"100%",height:height||360}}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:"Invalid Twitch URL"})}),bottomRow]})}),__WEBPACK_DEFAULT_EXPORT__=TwitchPlayer;TwitchPlayer.__docgenInfo={description:"",methods:[{name:"seekTo",docblock:null,modifiers:[],params:[{name:"to",optional:!1,type:{name:"number"}}],returns:null},{name:"getRawPlayer",docblock:null,modifiers:[],params:[],returns:{type:{name:"union",raw:"Y | null",elements:[{name:"Y"},{name:"null"}]}}},{name:"play",docblock:null,modifiers:[],params:[],returns:null},{name:"pause",docblock:null,modifiers:[],params:[],returns:null},{name:"getDuration",docblock:null,modifiers:[],params:[],returns:null},{name:"getCurrentTime",docblock:null,modifiers:[],params:[],returns:null},{name:"setPlayBackRate",docblock:null,modifiers:[],params:[],returns:null}],displayName:"TwitchPlayer",props:{playerProps:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  // required\n  src: string | MediaPlayerSrc[];\n  tracks?: PlayerTracks[];\n  // optional props\n  className?: string;\n  poster?: string;\n  controls?: boolean;\n  autoplay?: boolean;\n  loop?: boolean;\n  muted?: boolean;\n  preload?: 'none' | 'metadata' | 'auto';\n  width?: string | number;\n  height?: string | number;\n  crossorigin?: 'anonymous' | 'use-credentials';\n  // optional functions\n  onEnded?: () => void;\n  onPause?: () => void;\n  onPlay?: () => void;\n  onStart?: () => void;\n  onDurationChange?: (event: PlayerUpdateEvent<X>) => void;\n  onProgress?: (event: PlayerUpdateEvent<X>) => void;\n  bottomRow?: ReactNode;\n  player?: PlayerType;\n  custom?: Record<string, any>;\n}",signature:{properties:[{key:"src",value:{name:"union",raw:"string | MediaPlayerSrc[]",elements:[{name:"string"},{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  src: string;\n  type: string;\n}",signature:{properties:[{key:"src",value:{name:"string",required:!0}},{key:"type",value:{name:"string",required:!0}}]}}],raw:"MediaPlayerSrc[]"}],required:!0}},{key:"tracks",value:{name:"Array",elements:[{name:"Partial",elements:[{name:"Pick",elements:[{name:"HTMLTrackElement"},{name:"union",raw:"'default' | 'kind' | 'label' | 'src' | 'srclang'",elements:[{name:"literal",value:"'default'"},{name:"literal",value:"'kind'"},{name:"literal",value:"'label'"},{name:"literal",value:"'src'"},{name:"literal",value:"'srclang'"}]}],raw:"Pick<HTMLTrackElement, 'default' | 'kind' | 'label' | 'src' | 'srclang'>"}],raw:"Partial<\n  Pick<HTMLTrackElement, 'default' | 'kind' | 'label' | 'src' | 'srclang'>\n>"}],raw:"PlayerTracks[]",required:!1}},{key:"className",value:{name:"string",required:!1}},{key:"poster",value:{name:"string",required:!1}},{key:"controls",value:{name:"boolean",required:!1}},{key:"autoplay",value:{name:"boolean",required:!1}},{key:"loop",value:{name:"boolean",required:!1}},{key:"muted",value:{name:"boolean",required:!1}},{key:"preload",value:{name:"union",raw:"'none' | 'metadata' | 'auto'",elements:[{name:"literal",value:"'none'"},{name:"literal",value:"'metadata'"},{name:"literal",value:"'auto'"}],required:!1}},{key:"width",value:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}],required:!1}},{key:"height",value:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}],required:!1}},{key:"crossorigin",value:{name:"union",raw:"'anonymous' | 'use-credentials'",elements:[{name:"literal",value:"'anonymous'"},{name:"literal",value:"'use-credentials'"}],required:!1}},{key:"onEnded",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!1}},{key:"onPause",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!1}},{key:"onPlay",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!1}},{key:"onStart",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!1}},{key:"onDurationChange",value:{name:"signature",type:"function",raw:"(event: PlayerUpdateEvent<X>) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n  target: X;\n  currentTime: number;\n  duration: number;\n}",signature:{properties:[{key:"target",value:{name:"X",required:!0}},{key:"currentTime",value:{name:"number",required:!0}},{key:"duration",value:{name:"number",required:!0}}]}},name:"event"}],return:{name:"void"}},required:!1}},{key:"onProgress",value:{name:"signature",type:"function",raw:"(event: PlayerUpdateEvent<X>) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n  target: X;\n  currentTime: number;\n  duration: number;\n}",signature:{properties:[{key:"target",value:{name:"X",required:!0}},{key:"currentTime",value:{name:"number",required:!0}},{key:"duration",value:{name:"number",required:!0}}]}},name:"event"}],return:{name:"void"}},required:!1}},{key:"bottomRow",value:{name:"ReactNode",required:!1}},{key:"player",value:{name:"PlayerType",required:!1}},{key:"custom",value:{name:"Record",elements:[{name:"string"},{name:"any"}],raw:"Record<string, any>",required:!1}}]}},description:""}}}}}]);